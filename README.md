![Yamdb workflow](https://github.com/AndrewNemz/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

# yamdb_final 

(ссылка на документацию проекта: http://51.250.85.242/redoc/)


Учебный проект 16 спринта факультета бэкенд-разработки

### Технологии
- Python 3.7
- Django
- Docker
- Nginx

# Описание проекта Yambd.
Проект YaMDb собирает отзывы (Review) пользователей на произведения (Titles).

Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий (Category) может быть расширен администратором.

Произведению может быть присвоен жанр (Genre) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.

Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.

Пользователи могут оставлять комментарии к отзывам.
Добавлять отзывы, комментарии и ставить оценки могут только аутентифицированные пользователи.


### Пользовательские роли

+ Аноним — может просматривать описания произведений, читать отзывы и комментарии.
+ Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.
+ Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
+ Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
+ Суперюзер Django должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.

### Регистрация новых пользователей

+ Пользователь отправляет POST-запрос с параметрами email и username на эндпоинт /api/v1/auth/signup/.
+ Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email.
+ Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен).
+ В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.
После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт /api/v1/users/me/ и заполнить поля в своём профайле (описание полей — в документации).

### Создание пользователя администратором

+ Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт api/v1/users/ (описание полей запроса для этого случая — в документации). В этот момент письмо с кодом подтверждения пользователю отправлять не нужно.
+ После этого пользователь должен самостоятельно отправить свой email и username на эндпоинт /api/v1/auth/signup/ , в ответ ему должно прийти письмо с кодом подтверждения.
+ Далее пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен), как и при самостоятельной регистрации.

# Как запустить проект:
### Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/AndrewNemz/api_yamdb

cd api_yamdb
```

### Cоздать и активировать виртуальное окружение:

```
python -m venv venv
```

### Для *nix-систем:

```
source venv/bin/activate
```

### Для windows-систем:

```
source venv/Scripts/activate
```

### Установить зависимости из файла requirements.txt:

```
python -m pip install --upgrade pip
pip install -r requirements.txt
```

### Выполнить миграции:

```
cd api_yamdb
python3 manage.py migrate
```

### Создать суперпользователя (для раздачи прав админам):

```
python manage.py createsuperuser
```

### Запустить проект:

```
python manage.py runserver
```

### Сам проект и админ-панель искать по адресам:

```
http://127.0.0.1:8000

http://127.0.0.1:8000/admin
```

# Описание эндпоинтов:

Доступно в документации по локальному адресу: http://127.0.0.1:8000/redoc/

# Примеры запросов:

### Регистрация нового пользователя

#### url:
```
/api/v1/auth/signup/
```

JSON в запросе на добавление:

```json
{
    "email": "string",
    "username": "string"
}
```

Ответ JSON:
```json
{
    "email": "string",
    "username": "string"
}
```

### Получение списка всех категорий

Права доступа: Доступно без токена

#### url:
```
/api/v1/categories/
```

Ответ JSON:
```json
[
    {
        "count": 0,
        "next": "string",
        "previous": "string",
        "results": [
            {
                "name": "string",
                "slug": "string"
            }
        ]
    }
]
```

### Добавление комментария к отзыву

Права доступа: user, moderator, admin

#### url:
```
/api/v1/titles/{title_id}/reviews/{review_id}/comments/
```

структура JSON в запросе на добавление:
```json
{
    "text": "string"
}
```

В ответе:
```json
{
    "id": 0,
    "text": "string",
    "author": "string",
    "pub_date": "2019-08-24T14:15:22Z"
}
```
response status code 201

#### Возможные коды ошибок: 
400 Отсутствует обязательное поле или оно некорректно


# Запуск проекта в dev-режиме
- Клонировать репозиторий и перейти в него в командной строке:
```
git clone https://github.com/AndrewNemz/yamdb_final.git
cd api_yamdb/
```

- Установите и активируйте виртуальное окружение:
 ```
python3 -m venv env
source env/bin/activate
python3 -m pip install --upgrade pip
 ```
 
 - Установите зависимости из файла requirements.txt
  ```
pip install -r requirements.txt
 ```
 
 - Запустить приложение в контейнерах:
 
   из директории ```infra/```
   ```
   docker-compose up -d --build
   ```
   
  - Выполнить миграции:
 
    из директории ```infra/```
   
    ```
    docker-compose exec web python manage.py migrate
    ```
   
  - Собрать статику:
  
    из директории ```infra/```
    ```
    docker-compose exec web python manage.py collectstatic --no-input
    ```
    
   - Создать суперпользователя:
  
     из директории ```infra/```
     
     ```
     docker-compose exec web python manage.py createsuperuser
     ```
    
    
   - Остановить приложение в контейнерах:
  
      из директории ```infra/```
      
      ```
      docker-compose down -v
      ```


### Автор проекта:
    https://github.com/AndrewNemz

